package com.sense.sdk.saml.service;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.util.Iterator;
import java.util.zip.Inflater;
import java.util.zip.InflaterInputStream;

import org.apache.commons.codec.binary.Base64;
import org.dom4j.Document;
import org.dom4j.DocumentException;
import org.dom4j.DocumentHelper;
import org.dom4j.Element;

import com.sense.sdk.saml.pojo.AuthnRequestField;

/**
 * 处理saml request请求对象
 *
 * @author LiangRiLu
 * @Time 2019年12月14日下午1:41:53
 */
public class AuthnRequestHandler {

	private static final String ISSUER = "Issuer";

	/**
	 * 解析saml request的base64字符串
	 *
	 * @param encodedAuthnRequest
	 *            base64加密过的字符串
	 * @return
	 */
	public AuthnRequestField handleAuthnRequest(String encodedAuthnRequest) {
		String authnRequestXml = decode(encodedAuthnRequest);
		System.out.println("解析后的SAMLRequest------------：" + authnRequestXml);
		return readeAuthnRequest(authnRequestXml);
	}

	@SuppressWarnings("unchecked")
	private AuthnRequestField readeAuthnRequest(String authnRequestXml) {
		if (authnRequestXml == null) {
			return null;
		}
		AuthnRequestField authnRequestField = new AuthnRequestField();
		Document doc = null;
		try {
			doc = DocumentHelper.parseText(authnRequestXml); // 将字符串转为XML
			Element rootElt = doc.getRootElement(); // 获取根节点
			String version = rootElt.attributeValue("Version");
			String ID = rootElt.attributeValue("ID");
			String destination = rootElt.attributeValue("Destination");
			String assertionCondumerServiceUrl = rootElt.attributeValue("AssertionConsumerServiceURL");
			String protocolBinding = rootElt.attributeValue("ProtocolBinding");
			Iterator<Element> elementIterator = rootElt.elementIterator();
			while (elementIterator.hasNext()) {
				Element element = elementIterator.next();
				if (ISSUER.equals(element.getName())) {
					authnRequestField.setSpIssuer(element.getTextTrim());
					break;
				}
			}
			authnRequestField.setVersion(version);
			authnRequestField.setRequestId(ID);
			authnRequestField.setDestination(destination);
			authnRequestField.setAssertionConsumerServiceUrl(assertionCondumerServiceUrl);
			authnRequestField.setProtocolBinding(protocolBinding);
			return authnRequestField;

		} catch (DocumentException e) {
			e.printStackTrace();

		}
		return null;
	}

	/**
	 * 解密请求参数
	 *
	 * @param encSAMLRequest
	 * @return
	 */
	private String decode(String encSAMLRequest) {
		String ret = null;
		byte[] decodedBytes = null;
		try {
			decodedBytes = new Base64().decode(encSAMLRequest.getBytes("UTF-8"));
		} catch (UnsupportedEncodingException e) {
			e.printStackTrace();
		}
		try {
			ret = new String(inflate(decodedBytes, true));
		} catch (Exception ze) {
			ret = new String(decodedBytes);
		}
		return ret;
	}

	private byte[] inflate(byte[] bytes, boolean nowrap) throws Exception {
		Inflater decompressor = null;
		InflaterInputStream decompressorStream = null;
		ByteArrayOutputStream out = new ByteArrayOutputStream();
		try {
			decompressor = new Inflater(nowrap);
			decompressorStream = new InflaterInputStream(new ByteArrayInputStream(bytes), decompressor);
			byte[] buf = new byte[1024];
			int count;
			while ((count = decompressorStream.read(buf)) != -1) {
				out.write(buf, 0, count);
			}
			return out.toByteArray();
		} finally {
			if (decompressor != null) {
				decompressor.end();
			}
			try {
				if (decompressorStream != null) {
					decompressorStream.close();
				}
			} catch (IOException ioe) {
				ioe.printStackTrace();
			}
			try {
				if (out != null) {
					out.close();
				}
			} catch (IOException ioe) {
				ioe.printStackTrace();
			}
		}
	}

	public static void main(String[] args) {
		String str = "PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnhzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYSIgSUQ9ImlkLTQ1NmRmODY2NWNhOGY3ZjUzZGFkYzExOWNlZGM1MTJhODZjZmE5NzQiIEluUmVzcG9uc2VUbz0icGZ4ZGE2YWIyNzUtZTc4ZC04NjE3LTczMWYtMWY3MWVkODJhMTFlIiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAyMS0xMi0yMlQxMTowOTowOC44OTZaIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9sb2dpbi9zYW1sIj48c2FtbDpJc3N1ZXIgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDplbnRpdHkiPmh0dHA6Ly90ZXN0LmlkbWVzaC5jbi9wcm90b2NvbC9zYW1sLzEvbWV0YWRhdGE8L3NhbWw6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxkczpSZWZlcmVuY2UgVVJJPSIjaWQtNDU2ZGY4NjY1Y2E4ZjdmNTNkYWRjMTE5Y2VkYzUxMmE4NmNmYTk3NCI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+cFhMV3NpMWF0U2FqNnVEeGR2QzQyNTZKb2lZPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT54QjlER01NNk5sMG5pd3BsNUVYVDh5a0Y1d3o5VVZLYW4vU1IweUN3NFpNTDBDMmRTcWlMVTNEazhvL0dQUFY3bWJOK2FQbjRqcFVuajYzQys1MUJHRWZsM3VmU2Qyd3Yzc0srTTlwbFNaS2pJZHhGbWdCL2xUd2JvbGk3bHNFaS82ZEhIbXZhcFEvWXVoMU1zeE9QajBlemdVVDJFb2dMK3IzUU5wNUZrU0hJRU5UVVpQMnhBdklHZFRTOTNKUUVQS3M2ZWMySUJ5SDh6T252NmNTVEx2TjVYUytlQzNkM09NVXhmYW9OR2JqQ0dhTmNsaEZKRkZEbjVYcE1JbkU0M3FTM1AyTkRlT1h5OGZjb2FzZXNuaHFQKzg1RHJsNnFuQ0xWclZrWW9VcFovSFAwalVnYmVaVDBhZXE1VUtOeWlaZm5sbmpuT3lJblBQOS9zN3pBcmc9PTwvZHM6U2lnbmF0dXJlVmFsdWU+PGRzOktleUluZm8+PGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU+TUlJREJ6Q0NBZStnQXdJQkFnSUpBUHIvTXJsYzhFR2hNQTBHQ1NxR1NJYjNEUUVCQlFVQU1Cb3hHREFXQmdOVkJBTU1EM2QzZHk1bGVHRnRjR3hsTG1OdmJUQWVGdzB4TlRFeU1qZ3hPVEU1TkRWYUZ3MHlOVEV5TWpVeE9URTVORFZhTUJveEdEQVdCZ05WQkFNTUQzZDNkeTVsZUdGdGNHeGxMbU52YlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTkRvV3pMb3M0TFd4VG44R3l1MmxFYmw0V2NlbFViZ0xONXpZbTRyb244QWhzK3J2Y3N1MnprZEQvczZqZEdKSThXcUpLaFlLMnU2MXlnblhnQVpxQzZnZ3RGUG5CcGl6Y0R6amdORDJnK2F1Y1NvVU9ESHQ2N2YwZlF1QW11cE4venA1TVp5c0o2SUhMSm5ZTE5wZkpZazk2bFJ6OU9Ebk8xTXBxdHI5UFd4bStwejduenE1RjB2UmVwa2dwY1J4djZ1ZlFCamxyRnl0Y2N5RVZkWHJ2RnRralhjbmhWVk5TUjRrSHVPT01TNkQ3cGViU0oxbXJDbXNoYkQ1U1gxalhQQktGUEFqb3pZWDZQeHFMeFV4MVk0ZmFGRWY0TUJCVmNJbnlCNG9VUk5CMnM1OWhFRWkyanE5aXpORTdFYkVLNkJZNXNFaG9DUGw5bTMyekU2bGprQ0F3RUFBYU5RTUU0d0hRWURWUjBPQkJZRUZCOVprbEMxT3JrMnpsNTZ6ZzA4ZWk3c3MvK2lNQjhHQTFVZEl3UVlNQmFBRkI5WmtsQzFPcmsyemw1NnpnMDhlaTdzcy8raU1Bd0dBMVVkRXdRRk1BTUJBZjh3RFFZSktvWklodmNOQVFFRkJRQURnZ0VCQUFWb1RTUTVwQWlydzhPUjlGWjFiUlN1VERoWTl1eHpsL09MN2xVbXN2MmNNTmVDQjNCUlpxbTNtRnQrY3dOOEdzSDZmM3V2Tk9OSWhnRnBUR041TEVjWFF6ODl6SkV6QitxYUhxbWJGcEhRbC9zeDJCOGV6TmdULzg4MkgySUgwMGRYRVNFZnkvKzFnSGcycHhqR25oUkJONmVsL2dTYURpeVNJTUtiaWxEcmZmdXZ4aUNmYnBQTjBOUlJpUEpoZDJheTlLdUwvUnhRUmwxZ2w5Y0hhV2lvdVdXYmExYlNCYjJaUGh2MnJQTVVzRm85OG50a0dDT2JEWDZZMVNwa3Ftb1RicnNiR0ZzVEcyREx4bnZyNEdkTjFCU3IwVXUvS1YzYWRqNDdXa1hWUGVNWVF0aS9iUW14UUI4dFJGaHJ3ODBxYWtUTFV6cmVPOTZXemxCQk10WT08L2RzOlg1MDlDZXJ0aWZpY2F0ZT48L2RzOlg1MDlEYXRhPjwvZHM6S2V5SW5mbz48L2RzOlNpZ25hdHVyZT48c2FtbHA6U3RhdHVzPjxzYW1scDpTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz48L3NhbWxwOlN0YXR1cz48c2FtbDpBc3NlcnRpb24geG1sbnM6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiIgSUQ9ImlkLTgxMTcwOGMxY2FlMDQ2M2UzNTY0MjA0YWNmM2ZkYTdmNTM0MTM5MzAiIElzc3VlSW5zdGFudD0iMjAyMS0xMi0yMlQxMTowOTowOC44OTZaIiBWZXJzaW9uPSIyLjAiPjxzYW1sOklzc3VlciBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0OmVudGl0eSI+aHR0cDovL3Rlc3QuaWRtZXNoLmNuL3Byb3RvY29sL3NhbWwvMS9tZXRhZGF0YTwvc2FtbDpJc3N1ZXI+PGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+PGRzOlNpZ25lZEluZm8+PGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIi8+PGRzOlJlZmVyZW5jZSBVUkk9IiNpZC04MTE3MDhjMWNhZTA0NjNlMzU2NDIwNGFjZjNmZGE3ZjUzNDEzOTMwIj48ZHM6VHJhbnNmb3Jtcz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48ZHM6VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PC9kczpUcmFuc2Zvcm1zPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPjxkczpEaWdlc3RWYWx1ZT5udTBDWmVMdEJYWjFnQlNMY3cyRGdhQkVhWDQ9PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8+PGRzOlNpZ25hdHVyZVZhbHVlPks4dG9ENUdyTlVLUm5TSmt2cE9CTSt6R1p0OURlcEx6anY5RWtTNWlHSVA4NUpTMnBFRXc5R3pVTTRodUZQeEJOdk96TWNHQ2pEMzdZR0ZXMFlnSzFqa21CR3g4Z1hYS1JnbWZIREhYOGNIaGFyZmRheVBhaFRwQURWbFk3cnQwWjAxeGZiNG4yWmRQbERQdXB4cVh6ZisxczkxUXFNa2lKV21sc2l5YmtjdE9ZUUs0SmQ3WlVwOTQ5L0M5QTUxdnNON1Rhei9wdTd4amFzZDBiaDlUcXZ0VElUZHlwZUF6ZWpwYmtyL3pLTnZaSnFvOFBEdjVoSlEyLzFtVUtGRDBDQnFIdmZBQlhBVkh4dlJyMHRiemlRczFhMlRMVUMvUDJjcW1YcWpvZkZqZlB5dmN5Qkx5cmJmNmdFVHdubU1hQ1dqYVRQeldnZjNJSHNsLzhIM3gydz09PC9kczpTaWduYXR1cmVWYWx1ZT48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlEQnpDQ0FlK2dBd0lCQWdJSkFQci9NcmxjOEVHaE1BMEdDU3FHU0liM0RRRUJCUVVBTUJveEdEQVdCZ05WQkFNTUQzZDNkeTVsZUdGdGNHeGxMbU52YlRBZUZ3MHhOVEV5TWpneE9URTVORFZhRncweU5URXlNalV4T1RFNU5EVmFNQm94R0RBV0JnTlZCQU1NRDNkM2R5NWxlR0Z0Y0d4bExtTnZiVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFORG9XekxvczRMV3hUbjhHeXUybEVibDRXY2VsVWJnTE41elltNHJvbjhBaHMrcnZjc3UyemtkRC9zNmpkR0pJOFdxSktoWUsydTYxeWduWGdBWnFDNmdndEZQbkJwaXpjRHpqZ05EMmcrYXVjU29VT0RIdDY3ZjBmUXVBbXVwTi96cDVNWnlzSjZJSExKbllMTnBmSllrOTZsUno5T0RuTzFNcHF0cjlQV3htK3B6N256cTVGMHZSZXBrZ3BjUnh2NnVmUUJqbHJGeXRjY3lFVmRYcnZGdGtqWGNuaFZWTlNSNGtIdU9PTVM2RDdwZWJTSjFtckNtc2hiRDVTWDFqWFBCS0ZQQWpvellYNlB4cUx4VXgxWTRmYUZFZjRNQkJWY0lueUI0b1VSTkIyczU5aEVFaTJqcTlpek5FN0ViRUs2Qlk1c0Vob0NQbDltMzJ6RTZsamtDQXdFQUFhTlFNRTR3SFFZRFZSME9CQllFRkI5WmtsQzFPcmsyemw1NnpnMDhlaTdzcy8raU1COEdBMVVkSXdRWU1CYUFGQjlaa2xDMU9yazJ6bDU2emcwOGVpN3NzLytpTUF3R0ExVWRFd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVGQlFBRGdnRUJBQVZvVFNRNXBBaXJ3OE9SOUZaMWJSU3VURGhZOXV4emwvT0w3bFVtc3YyY01OZUNCM0JSWnFtM21GdCtjd044R3NINmYzdXZOT05JaGdGcFRHTjVMRWNYUXo4OXpKRXpCK3FhSHFtYkZwSFFsL3N4MkI4ZXpOZ1QvODgySDJJSDAwZFhFU0VmeS8rMWdIZzJweGpHbmhSQk42ZWwvZ1NhRGl5U0lNS2JpbERyZmZ1dnhpQ2ZicFBOME5SUmlQSmhkMmF5OUt1TC9SeFFSbDFnbDljSGFXaW91V1diYTFiU0JiMlpQaHYyclBNVXNGbzk4bnRrR0NPYkRYNlkxU3BrcW1vVGJyc2JHRnNURzJETHhudnI0R2ROMUJTcjBVdS9LVjNhZGo0N1drWFZQZU1ZUXRpL2JRbXhRQjh0UkZocnc4MHFha1RMVXpyZU85Nld6bEJCTXRZPTwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1sOlN1YmplY3Q+PHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6dHJhbnNpZW50IiBOYW1lUXVhbGlmaWVyPSJodHRwOi8vdGVzdC5pZG1lc2guY24vcHJvdG9jb2wvc2FtbC8xL21ldGFkYXRhIiBTUE5hbWVRdWFsaWZpZXI9ImNsb3VkLnRlbmNlbnQuY29tIj4xMDAxMjM8L3NhbWw6TmFtZUlEPjxzYW1sOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj48c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBBZGRyZXNzPSIxMjcuMC4wLjE6NTA5MDQiIEluUmVzcG9uc2VUbz0icGZ4ZGE2YWIyNzUtZTc4ZC04NjE3LTczMWYtMWY3MWVkODJhMTFlIiBOb3RPbk9yQWZ0ZXI9IjIwMjEtMTItMjJUMTE6MTA6MzguODk2WiIgUmVjaXBpZW50PSJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2xvZ2luL3NhbWwiLz48L3NhbWw6U3ViamVjdENvbmZpcm1hdGlvbj48L3NhbWw6U3ViamVjdD48c2FtbDpDb25kaXRpb25zIE5vdEJlZm9yZT0iMjAyMS0xMi0yMlQxMTowOToxNVoiIE5vdE9uT3JBZnRlcj0iMjAyMS0xMi0yMlQxMToxMDo0NVoiPjxzYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+PHNhbWw6QXVkaWVuY2U+Y2xvdWQudGVuY2VudC5jb208L3NhbWw6QXVkaWVuY2U+PC9zYW1sOkF1ZGllbmNlUmVzdHJpY3Rpb24+PC9zYW1sOkNvbmRpdGlvbnM+PHNhbWw6QXV0aG5TdGF0ZW1lbnQgQXV0aG5JbnN0YW50PSIwMDAxLTAxLTAxVDAwOjAwOjAwWiI+PHNhbWw6U3ViamVjdExvY2FsaXR5IEFkZHJlc3M9IjEyNy4wLjAuMTo1MDkwNCIvPjxzYW1sOkF1dGhuQ29udGV4dD48c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZFByb3RlY3RlZFRyYW5zcG9ydDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj48L3NhbWw6QXV0aG5Db250ZXh0Pjwvc2FtbDpBdXRoblN0YXRlbWVudD48c2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+PHNhbWw6QXR0cmlidXRlIEZyaWVuZGx5TmFtZT0idWlkIiBOYW1lPSJ1cm46b2lkOjAuOS4yMzQyLjE5MjAwMzAwLjEwMC4xLjEiIE5hbWVGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphdHRybmFtZS1mb3JtYXQ6dXJpIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj4xMDAxMjM8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgRnJpZW5kbHlOYW1lPSJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL1NBTUwvQXR0cmlidXRlcy9Sb2xlIiBOYW1lPSJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL1NBTUwvQXR0cmlidXRlcy9Sb2xlIiBOYW1lRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXR0cm5hbWUtZm9ybWF0OmJhc2ljIj48c2FtbDpBdHRyaWJ1dGVWYWx1ZSB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIiB4c2k6dHlwZT0ieHM6c3RyaW5nIj5xY3M6OmNhbTo6dWluLzEwMDAxMDE0OTI3MTpyb2xlTmFtZS9pZHJvbGUscWNzOjpjYW06OnVpbi8xMDAwMTAxNDkyNzE6c2FtbC1wcm92aWRlci9pZHRlc3Q8L3NhbWw6QXR0cmlidXRlVmFsdWU+PC9zYW1sOkF0dHJpYnV0ZT48c2FtbDpBdHRyaWJ1dGUgRnJpZW5kbHlOYW1lPSJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL1NBTUwvQXR0cmlidXRlcy9Sb2xlU2Vzc2lvbk5hbWUiIE5hbWU9Imh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vU0FNTC9BdHRyaWJ1dGVzL1JvbGVTZXNzaW9uTmFtZSIgTmFtZUZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmF0dHJuYW1lLWZvcm1hdDpiYXNpYyI+PHNhbWw6QXR0cmlidXRlVmFsdWUgeG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeHNpOnR5cGU9InhzOnN0cmluZyI+aWRyb2xlPC9zYW1sOkF0dHJpYnV0ZVZhbHVlPjwvc2FtbDpBdHRyaWJ1dGU+PC9zYW1sOkF0dHJpYnV0ZVN0YXRlbWVudD48L3NhbWw6QXNzZXJ0aW9uPjwvc2FtbHA6UmVzcG9uc2U+";
		AuthnRequestHandler handler = new AuthnRequestHandler();
		handler.handleAuthnRequest(str);
	}
}
